I"Ò<p>Celebrity that I am, I use Google Analytics to figure out exactly how many
times Iâ€™ve visited my own website in a given day.  The interface is
surprisingly good (given that itâ€™s a Google app), and generally Iâ€™m happy with
the service.  Also, itâ€™s free (assuming that you donâ€™t worry about giving
Google <em>even more</em> of your data).  Yay free.</p>

<p>The JavaScript that Google suggests using to embed their tracking code,
however, is a bit wasteful.  Take a look:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;script type="text/javascript"&gt;
  var gaJsHost = (
    ( "https:" == document.location.protocol ) ?
      "https://ssl." :
      "http://www."
    );
  document.write(
    unescape( "%3Cscript src='"             +
              gaJsHost                      +
              "google-analytics.com/ga.js'" +
              " type='text/javascript'%3E%3C/script%3E"
    )
  );
&lt;/script&gt;
&lt;script type="text/javascript"&gt;
  try {
    var pageTracker = _gat._getTracker("[YOUR TRACKING NUMBER]");
    pageTracker._trackPageview();
  } catch(err) {}
&lt;/script&gt;
</code></pre></div></div>

<p>I understand why they need to differentiate SSL requests, but passing a cobbled-together string through <code class="highlighter-rouge">unescape</code> before feeding it to <code class="highlighter-rouge">document.write</code> is a bit much, donâ€™t you think?  Also, injecting <code class="highlighter-rouge">pageTracker</code> and <code class="highlighter-rouge">gaJsHost</code> as new global variables isnâ€™t particularly friendly.</p>

<p>Given that I can make the assumption that this site is unencrypted, letâ€™s change the code a bit to fix these two points:</p>

<div class="highlighter-rouge"><div class="highlight"><pre class="highlight"><code>&lt;script
  type="text/javascript"
  src="http://www.google-analytics.com/ga.js"&gt;&lt;/script&gt;

&lt;script type="text/javascript"&gt;
  /*globals _gat */
  try {
    ( function ( $g ) {
      $g._getTracker("[YOUR TRACKING NUMBER]")._trackPageview();
    }( _gat ) );
  } catch ( err ) {}
&lt;/script&gt;
</code></pre></div></div>

<p>Thatâ€™s a little better.  And it even <a href="http://jslint.com/">JSLints</a>.</p>

:ET